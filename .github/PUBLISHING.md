# å‘å¸ƒæŒ‡å—

æœ¬é¡¹ç›®ä½¿ç”¨ [Changesets](https://github.com/changesets/changesets) è¿›è¡Œç‰ˆæœ¬ç®¡ç†å’Œè‡ªåŠ¨å‘å¸ƒã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ·»åŠ å˜æ›´è®°å½•

å®ŒæˆåŠŸèƒ½å¼€å‘æˆ–ä¿®å¤åï¼Œåˆ›å»ºå˜æ›´è®°å½•ï¼š

```bash
pnpm changeset
```

æŒ‰ç…§æç¤ºé€‰æ‹©ï¼š
- å˜æ›´ç±»å‹ï¼ˆpatch/minor/majorï¼‰
- è¾“å…¥å˜æ›´æè¿°ï¼ˆæ”¯æŒ Markdownï¼‰

### 2. è‡ªåŠ¨å‘å¸ƒæµç¨‹ï¼ˆæ¨èï¼‰

1. **åˆ›å»º PR**ï¼šå°†ä½ çš„ä»£ç æ¨é€åˆ°åˆ†æ”¯ï¼Œåˆ›å»º PR åˆ° main
2. **åˆå¹¶ PR**ï¼šä»£ç å®¡æŸ¥é€šè¿‡ååˆå¹¶
3. **è‡ªåŠ¨åˆ›å»ºå‘å¸ƒ PR**ï¼šChangesets bot ä¼šè‡ªåŠ¨åˆ›å»º "Version Packages" PR
4. **åˆå¹¶å‘å¸ƒ PR**ï¼šåˆå¹¶åè‡ªåŠ¨å‘å¸ƒåˆ° npm

## ğŸ“¦ å‘å¸ƒæµç¨‹è¯¦è§£

### è‡ªåŠ¨åŒ–æµç¨‹

å½“ä»£ç åˆå¹¶åˆ° main åˆ†æ”¯åï¼š

1. GitHub Actions æ£€æµ‹åˆ°æ–°çš„ changesets
2. è‡ªåŠ¨åˆ›å»º/æ›´æ–° "Version Packages" PRï¼ŒåŒ…å«ï¼š
   - ç‰ˆæœ¬å·æ›´æ–°
   - CHANGELOG ç”Ÿæˆ
   - changeset æ–‡ä»¶æ¸…ç†
3. åˆå¹¶è¯¥ PR è§¦å‘è‡ªåŠ¨å‘å¸ƒ

### æœ¬åœ°å‘å¸ƒï¼ˆå¤‡é€‰ï¼‰

```bash
# 1. æ·»åŠ å˜æ›´è®°å½•
pnpm changeset

# 2. æ›´æ–°ç‰ˆæœ¬
pnpm changeset version

# 3. æ„å»ºå¹¶å‘å¸ƒ
pnpm release

# 4. æ¨é€ä»£ç 
git push origin main --follow-tags
```

## ğŸ·ï¸ ç‰ˆæœ¬è§„èŒƒ

éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆSemantic Versioningï¼‰ï¼š

| ç±»å‹ | ç‰ˆæœ¬å˜åŒ– | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|
| **patch** | x.x.1 | Bug ä¿®å¤ã€æ–‡æ¡£æ›´æ–°ã€ä¾èµ–æ›´æ–° |
| **minor** | x.1.0 | æ–°å¢åŠŸèƒ½ã€å‘åå…¼å®¹çš„æ”¹è¿› |
| **major** | 1.0.0 | ç ´åæ€§æ›´æ”¹ã€æ¶æ„è°ƒæ•´ã€API å˜æ›´ |

## ğŸ”§ é…ç½®è¦æ±‚

### GitHub Secrets

åœ¨ä»“åº“è®¾ç½®ä¸­é…ç½®ï¼š
- `NPM_TOKEN`: npm å‘å¸ƒä»¤ç‰Œ
  1. è®¿é—® https://www.npmjs.com/settings/[username]/tokens
  2. åˆ›å»º "Automation" ç±»å‹çš„ token
  3. æ·»åŠ åˆ° GitHub Secrets

### æƒé™è®¾ç½®

ç¡®ä¿ GitHub Actions æœ‰ä»¥ä¸‹æƒé™ï¼š
- `contents: write` - åˆ›å»ºå‘å¸ƒ
- `pull-requests: write` - åˆ›å»º PR
- `id-token: write` - npm provenance

## ğŸ“‹ CI/CD å·¥ä½œæµ

### CI å·¥ä½œæµï¼ˆci.ymlï¼‰
- **è§¦å‘**ï¼šPush åˆ° main æˆ– PR
- **æµ‹è¯•çŸ©é˜µ**ï¼š
  - OS: Ubuntu, macOS, Windows
  - Node: 18, 20
- **æ­¥éª¤**ï¼šä¾èµ–å®‰è£… â†’ ç±»å‹æ£€æŸ¥ â†’ æ„å»º â†’ æµ‹è¯•

### Release å·¥ä½œæµï¼ˆrelease.ymlï¼‰
- **è§¦å‘**ï¼šPush åˆ° main
- **åŠŸèƒ½**ï¼š
  - æ£€æµ‹ changesets
  - åˆ›å»ºç‰ˆæœ¬ PR
  - è‡ªåŠ¨å‘å¸ƒåˆ° npm
  - æ”¯æŒ npm provenance

## ğŸ’¡ æœ€ä½³å®è·µ

1. **æ¯ä¸ª PR ä¸€ä¸ª changeset**ï¼šç¡®ä¿æ¯ä¸ªåŠŸèƒ½éƒ½æœ‰å˜æ›´è®°å½•
2. **æè¿°è¦æ¸…æ™°**ï¼šchangeset æè¿°ä¼šå‡ºç°åœ¨ CHANGELOG ä¸­
3. **é€‰æ‹©æ­£ç¡®çš„ç‰ˆæœ¬ç±»å‹**ï¼šå‚è€ƒç‰ˆæœ¬è§„èŒƒ
4. **ä¸è¦æ‰‹åŠ¨ä¿®æ”¹ç‰ˆæœ¬å·**ï¼šè®© changesets ç®¡ç†ç‰ˆæœ¬

## ğŸ” å¸¸è§é—®é¢˜

### Q: å¿˜è®°æ·»åŠ  changeset æ€ä¹ˆåŠï¼Ÿ
A: å¯ä»¥åœ¨ PR ä¸­è¡¥å……ï¼Œè¿è¡Œ `pnpm changeset` å¹¶æäº¤

### Q: å¦‚ä½•å‘å¸ƒé¢„å‘å¸ƒç‰ˆæœ¬ï¼Ÿ
A: ä½¿ç”¨ `pnpm changeset pre enter <tag>` è¿›å…¥é¢„å‘å¸ƒæ¨¡å¼

### Q: å¦‚ä½•æ’¤é”€å‘å¸ƒï¼Ÿ
A: npm ä¸æ”¯æŒæ’¤é”€ï¼Œåªèƒ½å‘å¸ƒæ–°ç‰ˆæœ¬ä¿®å¤

## ğŸ“š ç›¸å…³é“¾æ¥

- [Changesets æ–‡æ¡£](https://github.com/changesets/changesets)
- [è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ](https://semver.org/lang/zh-CN/)
- [npm å‘å¸ƒæ–‡æ¡£](https://docs.npmjs.com/cli/v8/commands/npm-publish)